name: macos

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  macos-test:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2

    # Error Check
    - name: copy
      run : |
        cp -r ${GITHUB_WORKSPACE} ~/

    - name: remove ACL
      run : |
        chmod -N "/Volumes/Macintosh HD/Users/runner"
        chmod -N "/Volumes/Macintosh HD/Users/runner/.config"

    - name: unlink node@12
      run : |
        brew unlink node@12

    - name: run
      run : |
        cd ~/dotfiles
        make run

    - name: Load .zprofile
      run : |
        touch error.log
        zsh ~/.zprofile 2> error.log
        cat error.log
        if [ -s error.log ]; then false; fi

    - name: Load .zshrc
      run : |
        touch error.log
        zsh ~/.zshrc 2> error.log
        cat error.log
        if [ -s error.log ]; then false; fi

